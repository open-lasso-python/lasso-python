version: "3"

tasks:
  setup:
    desc: Setup the development environment.
    cmds:
      - uv sync

  lint:
    desc: Lints the code and reports on issues.
    cmds:
      - uv run ruff check .
      # - uv run ruff format . --check

  build:
    desc: Builds the python package
    cmds:
      - rm -rf dist/*
      - uv pip install build
      - uv build --sdist --wheel

  test:
    desc: Runs tests on the code
    cmds:
      - >
        uv run pytest test
        --cov=lasso
        --cov-report=html

  docs:serve:
    desc: Serve the documentation locally for development and testing
    deps:
      - test
      - docs:changelog
    cmds:
      - uv run mkdocs serve

  docs:build:
    desc: Build the documentation
    deps:
      - test
      - docs:changelog
    cmds:
      - uv run mkdocs build

  docs:deploy:
    desc: Deploys the docs to GitHub (be careful!)
    deps:
      - test
      - docs:changelog
    cmds:
      - uv run mkdocs gh-deploy

  docs:changelog:
    desc: Generates the changelog
    cmds:
      - >
        uv run git-changelog .
        --output CHANGELOG.md
        --style angular
        --template angular
